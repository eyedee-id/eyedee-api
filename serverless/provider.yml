provider:
  name: aws
  runtime: nodejs14.x
  region: ${self:custom.region.${self:custom.stage}}
  profile: ${self:custom.profile.${self:custom.stage}}
  memorySize: 512
  timeout: 6
  logRetentionInDays: 7
  httpApi:
    # stageName: ${self:custom.stage}
    name: ${self:service}-${self:custom.stage}
    payload: '2.0'
    cors: true
    authorizers:
      authorizerCognito:
        identitySource: $request.header.Authorization
        issuerUrl: !Sub https://cognito-idp.${opt:region, self:provider.region}.amazonaws.com/${CognitoUserPool}
        audience:
          Ref: CognitoUserPoolClient
  iamRoleStatements: ${file(./serverless/iam.yml):iamRoleStatements}
  environment:
    stage: ${self:custom.stage}
    region: ${self:custom.region.${self:custom.stage}}
    dynamodb_table_user: ${self.custom.dynamodbTableUser}
    dynamodb_table_main: ${self.custom.dynamodbTableMain}
    s3_bucket: ${self:custom.s3Bucket}
