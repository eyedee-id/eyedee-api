provider:
  name: aws
  runtime: nodejs14.x
  region: ${self:custom.region.${self:custom.stage}}
  profile: ${self:custom.profile.${self:custom.stage}}
  memorySize: 512
  timeout: 6
  logRetentionInDays: 7
  httpApi:
    stageName: ${self:custom.stage}
    name: ${self:service}-${self:custom.stage}
    payload: '2.0'
    cors: true
    authorizers:
      authorizerCognito:
        identitySource: $request.header.Authorization
        issuerUrl:
          Fn::Join:
            - ''
            - - 'https://cognito-idp.'
              - '${opt:region, self:provider.region}'
              - '.amazonaws.com/'
              - ${self:custom.cognito.userPoolId.${self:custom.stage}}
        audience: ${self:custom.cognito.userPoolClientIds.${self:custom.stage}}
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
        - dynamodb:BatchWriteItem
        - dynamodb:BatchGetItem
      Resource:
        Fn::GetAtt: [ TableMain, Arn ]
